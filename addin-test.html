<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>API Test</title>
</head>
<body>
    <h1>GitHub Pages API Test v3.0</h1>
    <p><strong>Version: 2026-01-23 19:50 UTC</strong></p>
    <pre id="output"></pre>

    <script>
        let output = '';
        function log(msg) {
            output += msg + '\n';
            console.log(msg);
            document.getElementById('output').textContent = output;
        }

        log('VERSION: 2026-01-23 19:50 UTC');
        log('1. Page loaded');
        log('2. JavaScript running');

        // Define initialize as global function
        window.initialize = function(api, state, callback) {
            log('3. ✅ initialize() CALLED!');
            log('4. API: ' + (api ? 'EXISTS' : 'NULL'));

            if (api) {
                log('5. API type: ' + typeof api);
                log('6. API.call: ' + (typeof api.call));
                log('7. API.getSession: ' + (typeof api.getSession));

                api.getSession(function(cred) {
                    log('8. ✅ Got user: ' + cred.userName);
                    log('9. ✅ Database: ' + cred.database);
                }, function(err) {
                    log('8. ❌ Session error: ' + err);
                });
            }

            callback();
        };

        window.focus = function(api, state) {
            log('FOCUS: api=' + (api ? 'YES' : 'NO'));
        };

        window.blur = function(api, state) {
            log('BLUR');
        };

        log('Waiting for initialize()...');
    </script>
</body>
</html>
